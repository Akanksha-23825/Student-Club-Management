<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Club Recommendation | RVCE</title>
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script>
        if (!localStorage.getItem("role")) {
            alert("Unauthorized access. Please login first.");
            window.location.href = "login.html";
        }
    </script>
    <style>
        .recommend-header { 
            background: linear-gradient(135deg, #0f172a 0%, #0ea5e9 60%, #22c55e 120%); 
            color: white; padding: 70px 20px; text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.12);
        }
        .recommend-header a { color: rgba(255,255,255,0.9); text-decoration: none; font-size: 14px; font-weight: 600; }
        .interest-section { max-width: 1000px; margin: 40px auto; padding: 0 20px; display: block; overflow: hidden; }
        h3 { margin-top: 35px; border-left: 5px solid var(--brand); padding-left: 15px; color: var(--ink); font-weight: 700; }
        .interest-grid { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 15px; }
        .interest-btn { 
            border: 1.5px solid rgba(15, 23, 42, 0.12); background: white; padding: 12px 18px; 
            border-radius: 12px; cursor: pointer; transition: var(--transition); 
            font-weight: 600; color: #64748b;
        }
        .interest-btn.active { 
            background: var(--brand); color: white; border-color: var(--brand);
            box-shadow: 0 8px 16px rgba(14, 165, 233, 0.3); transform: translateY(-2px);
        }
        .recommend-btn { 
            display: block; margin: 60px auto 40px; background: var(--brand); 
            color: white; border: none; padding: 18px 60px; border-radius: 15px; 
            font-size: 17px; font-weight: 800; cursor: pointer; 
            box-shadow: 0 10px 24px rgba(14, 165, 233, 0.35); transition: var(--transition);
            position: relative; z-index: 5;
        }
        .results { max-width: 1000px; margin: 20px auto 80px; padding: 0 20px; clear: both; }
        .result-card { 
            background: var(--card); border-radius: 20px; padding: 35px; margin-bottom: 25px; 
            border: 1px solid rgba(15, 23, 42, 0.06); box-shadow: var(--shadow-1); cursor: pointer; transition: var(--transition);
        }
        .tag { background: var(--bg-2); color: var(--ink); padding: 5px 12px; border-radius: 6px; font-size: 11px; font-weight: 800; text-transform: uppercase; }
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(15, 23, 42, 0.45); backdrop-filter: blur(8px); }
        .modal-content { background-color: var(--card); margin: 5vh auto; padding: 50px; border-radius: 24px; width: 90%; max-width: 800px; max-height: 85vh; overflow-y: auto; position: relative; box-shadow: 0 30px 70px rgba(15, 23, 42, 0.35); border: 1px solid rgba(15, 23, 42, 0.08); }
        .close-button { position: absolute; right: 30px; top: 20px; font-size: 32px; color: #94a3b8; cursor: pointer; }
    </style>
</head>
<body>

<div class="recommend-header">
    <a href="index.html">â† Back to Dashboard</a>
    <h1>ğŸ¯ Club Recommendation</h1>
    <p>Select your interests to find your perfect team at RVCE</p>
</div>

<div class="interest-section">
    <h3>ğŸ’» Software & Tech</h3>
    <div class="interest-grid">
        <button class="interest-btn" data-interest="Coding">ğŸ’» Coding</button>
        <button class="interest-btn" data-interest="Web Development">ğŸŒ Web Development</button>
        <button class="interest-btn" data-interest="Robotics">&#129302; Robotics</button>
        <button class="interest-btn" data-interest="AI">ğŸ§  AI</button>
        <button class="interest-btn" data-interest="Machine Learning">ğŸ“Š Machine Learning</button>
        <button class="interest-btn" data-interest="Cloud Computing">â˜ï¸ Cloud Computing</button>
        <button class="interest-btn" data-interest="Quantum Computing">âš›ï¸ Quantum Computing</button>
    </div>

    <h3>ğŸš€ Core Engineering & Space</h3>
    <div class="interest-grid">
        <button class="interest-btn" data-interest="Aerospace">ğŸš€ Aerospace</button>
        <button class="interest-btn" data-interest="Rocketry">ğŸ›°ï¸ Rocketry</button>
        <button class="interest-btn" data-interest="Astronomy">ğŸŒŒ Astronomy</button>
        <button class="interest-btn" data-interest="HAM Radio">ğŸ“¡ HAM Radio</button>
    </div>

    <h3>ğŸ­ Cultural & Creative Arts</h3>
    <div class="interest-grid">
        <button class="interest-btn" data-interest="Music">ğŸµ Music</button>
        <button class="interest-btn" data-interest="Dance">ğŸ’ƒ Dance</button>
        <button class="interest-btn" data-interest="Acting">ğŸ­ Acting</button>
        <button class="interest-btn" data-interest="Film Making">ğŸ¬ Film Making</button>
        <button class="interest-btn" data-interest="Photography">ğŸ“· Photography</button>
        <button class="interest-btn" data-interest="Fashion">ğŸ‘— Fashion</button>
        <button class="interest-btn" data-interest="Painting">ğŸ¨ Painting</button>
        <button class="interest-btn" data-interest="Sketching">âœï¸ Sketching</button>
        <button class="interest-btn" data-interest="Crochet">ğŸ§¶ Crochet</button>
        <button class="interest-btn" data-interest="Debate">ğŸ¤ Debate</button>
    </div>

    <h3>ğŸŒ± Social, Leadership & Policy</h3>
    <div class="interest-grid">
        <button class="interest-btn" data-interest="Community Service">ğŸ¤ Community Service</button>
        <button class="interest-btn" data-interest="Leadership">ğŸ§‘â€ğŸ’¼ Leadership</button>
        <button class="interest-btn" data-interest="Entrepreneurship">ğŸš€ Entrepreneurship</button>
        <button class="interest-btn" data-interest="Teaching">ğŸ§‘â€ğŸ« Teaching</button>
        <button class="interest-btn" data-interest="Social Awareness">ğŸ“¢ Social Awareness</button>
        <button class="interest-btn" data-interest="Plantation">ğŸŒ± Plantation</button>
        <button class="interest-btn" data-interest="Event Management">ğŸ“… Event Management</button>
        <button class="interest-btn" data-interest="Public Policy">ğŸ›ï¸ Public Policy</button>
    </div>
</div>

<button class="recommend-btn" onclick="recommendClubs()">Find My Clubs</button>

<div class="results">
    <div id="result"></div>
</div>

<div id="recommendModal" class="modal">
    <div class="modal-content">
        <span class="close-button" onclick="closeRecommendModal()">&times;</span>
        <div id="modalBody"></div>
    </div>
</div>

<a href="chatbot.html" class="chatbot-fab" aria-label="Open Chatbot" title="Open Chatbot">&#129302;</a>

<script>
    document.querySelectorAll(".interest-btn").forEach(btn => {
        btn.addEventListener("click", () => btn.classList.toggle("active"));
    });

    let currentRecommendations = [];

    function recommendClubs() {
        const selected = Array.from(document.querySelectorAll(".interest-btn.active")).map(btn => btn.dataset.interest);
        const resultBox = document.getElementById("result");

        if (selected.length === 0) {
            resultBox.innerHTML = "<p style='text-align:center; color:#888;'>Please select at least one interest.</p>";
            return;
        }

        fetch("http://localhost:3000/api/recommend", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ interests: selected })
        })
        .then(res => res.json())
        .then(data => {
            currentRecommendations = data; 
            resultBox.innerHTML = "<h2 style='margin-bottom:25px; color:var(--ink); font-weight:800;'>Top Picks for You</h2>";
            
            if (data.length === 0) {
                resultBox.innerHTML += "<p style='text-align:center;'>No matching clubs found for these interests.</p>";
                return;
            }

            data.forEach((club, index) => {
                resultBox.innerHTML += `
                    <div class="result-card" onclick="openRecommendModal(${index})">
                        <span class="tag">${club.category}</span>
                        <h3 style="margin-top:12px; color:var(--brand);">${club.club_name}</h3>
                        <p style="color:#64748b;">${club.description ? club.description.substring(0, 150) + '...' : 'View full details'}</p>
                    </div>`;
            });
        });
    }

    function openRecommendModal(index) {
        const club = currentRecommendations[index];
        const modalBody = document.getElementById("modalBody");
        modalBody.innerHTML = `
            <h1 style="color: var(--brand); font-weight: 800;">${club.club_name}</h1>
            <p style="text-transform: uppercase; font-size: 13px; font-weight: 700; color: var(--brand);">${club.category} Club</p>
            <p style="margin: 20px 0; line-height: 1.8; color: #4b5563;">${club.description || 'No description available.'}</p>
            <div style="background: var(--bg-light); padding: 30px; border-radius: 18px; border-left: 6px solid var(--brand);">
                <h3 style="margin:0; border:none; padding:0;">ğŸ† Notable Achievements</h3>
                <div style="white-space: pre-wrap; margin-top:10px;">${club.achievement_text || "No achievements listed."}</div>
            </div>`;
        document.getElementById("recommendModal").style.display = "block";
        document.body.style.overflow = "hidden";
    }

    function closeRecommendModal() {
        document.getElementById("recommendModal").style.display = "none";
        document.body.style.overflow = "auto";
    }
</script>
</body>
</html>
